name: Update hydirect.list

on:
  schedule:
    # 每天北京时间早上 06:00 运行 (UTC 22:00)
    - cron: '0 22 * * *'
  workflow_dispatch: # 允许你手动点击按钮触发

# 赋予写权限，否则无法提交代码
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    # 1. 拉取代码
    - name: Checkout code
      uses: actions/checkout@v3
      
    # 2. 准备 Python 环境
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    # 3. 安装依赖 (requests, pytz)
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        
    # 4. 运行你的核心脚本
    - name: Run Generator Script
      run: python main.py
      
    # 5. 提交并推送结果
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        # 强制添加 hydirect.list
        git add hydirect.list
        # 如果没有变化(今天规则没更新)，不报错退出
        git commit -m "Auto-update hydirect.list" || exit 0
        # 强制推送
        git push -f origin main
